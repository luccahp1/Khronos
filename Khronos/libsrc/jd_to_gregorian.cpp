/* khronos/jd_to_gregorian.cpp */
#include <khronos/gregorian_calendar.hpp>
#include <cmath>
namespace khronos {
	void jd_to_gregorian(jd_t JD, year_t& Y, month_t& M, day_t& D, hour_t& h, minute_t& mi, second_t& s) { long double Zl = std::floor(JD + 0.5L); long double Fl = (JD + 0.5L) - Zl; long double A = Zl; long double alpha = std::floor((A - 1867216.25L) / 36524.25L); if (Zl >= 2299161.0L) { A += 1 + alpha - std::floor(alpha / 4.0L); } long double B = A + 1524; long double C = std::floor((B - 122.1L) / 365.25L); long double Dd = std::floor(365.25L * C); long double E = std::floor((B - Dd) / 30.6001L); long double day = B - Dd - std::floor(30.6001L * E) + Fl; int month = (E < 14) ? int(E - 1) : int(E - 13); long long year = (month > 2) ? long long(C - 4716) : long long(C - 4715); long double frac = day - std::floor(day); long double totalSeconds = frac * 86400.0L; if (totalSeconds >= 86399.9995L) { totalSeconds = 0.0L; day = std::floor(day) + 1.0L; } h = hour_t(totalSeconds / 3600.0L); totalSeconds -= h * 3600.0L; mi = minute_t(totalSeconds / 60.0L); totalSeconds -= mi * 60.0L; s = second_t(totalSeconds); Y = year_t(year); M = month_t(month); D = day_t(std::floor(day)); }
}